<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rakuten API Example</title>
</head>
<body>
    <div>
        <label for="tag-id">Tag ID: </label>
        <input type="text" id="tag-id" />
        <button type="button" class="get-information">楽天API発動！</button>
    </div>

    <div class="display-information-wrapper">
        <ul></ul>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function(){
            let getInformationButton = $('button.get-information');
            let appId = '1000646968939020152';
            let reqUrl = 'https://app.rakuten.co.jp/services/api/IchibaItem/Search/20170706';
            let displayInformationWrapper = $('.display-information-wrapper');

            getInformationButton.click(()=>{
                let tagId = $('#tag-id').val(); // 入力されたtagidを取得

                $.ajax({
                    url: reqUrl,
                    type: 'GET',
                    data: {
                        'applicationId': appId,
                        'formatVersion': 2,
                        'hits': 5,
                        'genreId': 565171,
                        'tagId': tagId // tagidをAPIリクエストに追加
                    }
                })
                .done((data)=>{
                    let items = data.Items;
                    let itemListHtml = '';

                    // 商品情報をループで処理
                    for(let i in items) {
                        let item = items[i];

                        itemListHtml += `<li class="item">
                                            <figure class="item-image">
                                                <img src="${item['mediumImageUrls'][0]}" />
                                            </figure>
                                            <div class="item-name">${item['itemName']}</div>
                                            <div class="item-price">￥${item['itemPrice']}</div>
                                        </li>`;
                    }

                    displayInformationWrapper.find('ul').empty().append(itemListHtml); // 表示エリアをクリアしてから結果を表示

                })
                .fail(()=>{
                    console.log('err');
                })
            });
        });
    </script>
</body>
</html>
